@model int // CourseId
@{
    ViewBag.Title = "Payment";
}

<h2>Payment for @ViewBag.CourseName</h2>
<p>Amount: $@ViewBag.Amount</p>

<form asp-action="ProcessPayment" method="post">
    <input type="hidden" name="courseId" value="@Model" />
    <input type="hidden" name="amount" value="@ViewBag.Amount" />
    <div id="paypal-button-container"></div>
</form>

<script src="https://www.paypal.com/sdk/js?client-id=AVmFNf9IlzJwcCXKrRO__yWnBqLo17m1L78s-D_y7xXnu-5wZMELlM8hyC6uFjTMMy1uWbcaFLhDbmqZ"></script>
<script>
    paypal.Buttons({
        createOrder: function (data, actions) {
            return actions.order.create({
                purchase_units: [{ amount: { value: '@ViewBag.Amount' } }]
            });
        },
        onApprove: function (data, actions) {
            return actions.order.capture().then(function (details) {
                window.location.href = '@Url.Action("PaymentSuccess", "CourseEnrollment")?courseId=@Model&transactionId=' + details.id;
            });
        },
        onCancel: function () {
            window.location.href = '@Url.Action("PaymentFailure", "CourseEnrollment")?courseId=@Model';
        }
    }).render('#paypal-button-container');
</script>